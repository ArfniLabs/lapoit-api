<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lapoit.api.mapper.UserGameMapper">

    <!-- 중복 참가 체크 -->
    <select id="existsByPlayGameIdAndUserId" resultType="boolean">
        SELECT EXISTS (
        SELECT 1
        FROM user_game
        WHERE play_game_id = #{playGameId}
        AND id = #{userId}
        )
    </select>

    <!-- 게임 참가 -->
    <insert id="insertUserGame">
        INSERT INTO user_game (
        play_game_id,
        id,
        game_id,
        store_id,
        attendance_date
        )
        VALUES (
        #{playGameId},
        #{userId},
        #{gameId},
        #{storeId},
        CURDATE()
        )
    </insert>

    <!-- 참가자 목록 조회 -->
    <select id="findPlayersByPlayGameId"
            resultType="com.lapoit.api.dto.playgame.UserGamePlayerDto">
        SELECT
        u.id       AS userId,
        u.user_nickname AS nickname
        FROM user_game ug
        JOIN user u ON ug.id = u.id
        WHERE ug.play_game_id = #{playGameId}
    </select>



    <select id="isOutPlayer" resultType="boolean">
        SELECT status = 'OUT'
        FROM user_game
        WHERE play_game_id = #{playGameId}
        AND id = #{userId}
    </select>


    <update id="outPlayer">
        UPDATE user_game
        SET status = 'OUT'
        WHERE play_game_id = #{playGameId}
        AND id = #{userId}
    </update>


</mapper>
