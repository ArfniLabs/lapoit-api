<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lapoit.api.mapper.UserScoreMapper">

    <!-- ========================= -->
    <!-- ResultMap -->
    <!-- ========================= -->
    <resultMap id="UserScoreResultMap" type="com.lapoit.api.domain.UserScore">
        <id property="userScoreId" column="user_score_id"/>
        <result property="userId" column="user_id"/>
        <result property="storeId" column="store_id"/>
        <result property="score" column="score"/>
    </resultMap>

    <!-- ========================= -->
    <!-- 유저 ID로 점수 목록 조회 -->
    <!-- ========================= -->
    <select id="findByUserId"
            parameterType="long"
            resultMap="UserScoreResultMap">
        SELECT
        user_score_id,
        user_id,
        store_id,
        score
        FROM user_score
        WHERE user_id = #{userId}
    </select>

    <!-- ========================= -->
    <!-- 유저 + 지점 단건 조회 -->
    <!-- ========================= -->
    <select id="findByUserIdAndStoreId"
            resultMap="UserScoreResultMap">
        SELECT
        user_score_id,
        user_id,
        store_id,
        score
        FROM user_score
        WHERE user_id = #{userId}
        AND store_id = #{storeId}
    </select>

    <!-- ========================= -->
    <!-- 유저 점수 테이블 생성 -->
    <!-- ========================= -->
    <insert id="save"
            parameterType="com.lapoit.api.domain.UserScore"
            useGeneratedKeys="true"
            keyProperty="userScoreId">
        INSERT INTO user_score (
        user_id,
        store_id,
        score
        ) VALUES (
        #{userId},
        #{storeId},
        #{score}
        )
    </insert>

</mapper>
